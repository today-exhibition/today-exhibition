{% extends 'common/layout.html' %}

{% block content %}
<!-- 전시 이름 -->
<h3>{{exhibition.title}}</h3>

<!-- 전시 정보 -->
<div class="exhibition-details row">
    <div class="image-container col-4 text-center">
        <img src="{{ exhibition.thumbnail_img }}" alt="{{ exhibition.title }}" style="max-height: 300px;">
    </div>
    <div class="info-container col-8">
        <table class="table">
            <tr>
                <th>기간</th>
                <td colspan="2">{{ exhibition.start_date }} ~ {{ exhibition.end_date }}</td>
            </tr>
            {% if exhibition.opening_hours %}
                <tr>
                    <th>시간</th>
                    <td colspan="2">{{ exhibition.opening_hours }}</td>
                </tr>
            {% endif %}

            <tr>
                <th>장소</th>
                {% if exhibition.area %}
                    <td>{{ exhibition.area }}</td>
                    <td>{{ exhibition.gallery_name }}</td>
                {% else %}
                    <td colspan="2">{{ exhibition.gallery_name }}</td>
                {% endif %}
            </tr>

            {% if exhibition.price %}
                <tr>
                    <th>요금</th>
                    <td colspan="2">{{ exhibition.price }}</td>
                </tr>
            {% endif %}

            {% if exhibition.artist_name %}
                <tr>
                    <th>작가</th>
                    <td colspan="2">{{ exhibition.artist_name }}</td>
                </tr>
            {% endif %}
        </table>
        <div class="booking">
            <form action="{{ url_for('booking.booking_detail', id=id) }}">
                <input type="submit" value="예매하기">
            </form>
        </div>
    </div>
</div>


<!-- 전시 소개 -->
{% if exhibition.description %}
<h3>전시소개</h3>
{{ exhibition.description }}
{% endif %}

<br>
<!-- 코멘트 작성 -->
<div class="input-group mb-3">
    <form action="{{ url_for('exhibition.add_comment', id=id) }}" method="POST" class="w-100">
        <div class="input-group">
            <textarea id="comment" name="content" rows="1" class="form-control rounded"
                placeholder="내용을 입력해주세요."></textarea>
            <div class="input-group-append">
                <button type="submit" class="btn btn-outline-secondary rounded" id="button-addon2">등록</button>
            </div>
        </div>
    </form>
</div>

<div class="comment">
    <ul class="list-group list-group-flush">
        {% for comment in comments %}
        <li class="list-group-item">
            <div class="d-flex justify-content-between">
                <span class="card-title">{{ comment.nickname }} | {{ comment.created_at }}</span>
            </div>
            <div class="comment-actions">
                {% if "user_id" in session and session["user_id"] == comment.user_id %}
                <div class="comment-content" style="display: {% if comment.editing %}none{% endif %};">
                    <p class="card-text">{{ comment.content }}</p>
                </div>
                <div class="d-flex justify-content-end">
                    <button class="edit-button btn btn-secondary" data-comment-id="{{ comment.comment_id }}">수정</button>
                    <form class="edit-form" id="edit-form-{{ comment.comment_id }}" style="display: {% if comment.editing %}block{% else %}none{% endif %};"
                        action="{{ url_for('exhibition.edit_comment', id=id, comment_id=comment.comment_id) }}"
                        method="POST">
                        <div class="d-flex">
                            <textarea name="edited_content" rows="2" cols="50">{{ comment.content }}</textarea>
                            <button type="submit" class="save-button btn btn-primary">수정 완료</button>
                        </div>
                    </form>
                    <form class="delete-form"
                        action="{{ url_for('exhibition.delete_comment', id=id, comment_id=comment.comment_id) }}"
                        method="POST" style="display: inline;">
                        <button type="submit" class="delete-button btn btn-danger">삭제</button>
                    </form>
                </div>
                {% else %}
                <div class="comment-content">
                    <p class="card-text" style="display: block;">{{ comment.content }}</p>
                </div>
                {% endif %}
            </div>
        </li>
        {% endfor %}
    </ul>
</div>


{% endblock %}